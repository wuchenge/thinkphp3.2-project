<include file="Public:header2"/>
<body>
<nav class="breadcrumb"><i class="Hui-iconfont">&#xe67f;</i> 首页 <span class="c-gray en">&gt;</span> 商品管理 <span class="c-gray en">&gt;</span> <if condition="empty($newsxiugl['id'])">商品添加<else/>商品修改</if> <a class="btn btn-success radius r" style="line-height:1.6em;margin-top:3px" href="javascript:location.replace(location.href);" title="刷新" ><i class="Hui-iconfont">&#xe68f;</i></a></nav>
<article class="page-container">
	<form class="form form-horizontal" id="form-news-add" enctype='multipart/form-data' method="post" action="{:U('jifen/edit?id='.$newsxiugl['id'])}" >
		<div class="row cl">
			<label class="form-label col-xs-4 col-sm-2"><span class="c-red">*</span>商品标题：</label>
			<div class="formControls col-xs-8 col-sm-9">
				<input type="text" class="input-text" value="{$newsxiugl.gname}" placeholder="" id="gname" name="gname">
			</div>
		</div>
		<div class="row cl">
			<label class="form-label col-xs-4 col-sm-2"><span class="c-red">*</span>关键词：</label>
			<div class="formControls col-xs-8 col-sm-9">
				<input type="text" class="input-text" value="{$newsxiugl.keywords}" placeholder="" id="keywords" name="keywords">
			</div>
		</div>
		<div class="row cl">
			<label class="form-label col-xs-4 col-sm-2"><span class="c-red">*</span>描述：</label>
			<div class="formControls col-xs-8 col-sm-9">
				<textarea name="description"  cols="" rows="" class="textarea"  placeholder="说点什么...最少输入10个字符" datatype="*10-100" dragonfly="true" nullmsg="备注不能为空！" onKeyUp="textarealength(this,200)">{$newsxiugl.description}</textarea>
				<p class="textarea-numberbar"><em class="textarea-length">0</em>/200</p>
			</div>
		</div>
		<div class="row cl">
			<label class="form-label col-xs-4 col-sm-2">描述2：</label>
			<div class="formControls col-xs-8 col-sm-9">
				<textarea name="description2"  cols="" rows="" class="textarea"  placeholder="说点什么...最少输入10个字符" datatype="*10-100" dragonfly="true" nullmsg="备注不能为空！" onKeyUp="textarealength(this,200)">{$newsxiugl.description2}</textarea>
				<p class="textarea-numberbar"><em class="textarea-length">0</em>/200</p>
			</div>
		</div>
		<div class="row cl">
			<label class="form-label col-xs-4 col-sm-2">描述3：</label>
			<div class="formControls col-xs-8 col-sm-9">
				<textarea name="description3"  cols="" rows="" class="textarea"  placeholder="说点什么...最少输入10个字符" datatype="*10-100" dragonfly="true" nullmsg="备注不能为空！" onKeyUp="textarealength(this,200)">{$newsxiugl.description3}</textarea>
				<p class="textarea-numberbar"><em class="textarea-length">0</em>/200</p>
			</div>
		</div>
		<div class="row cl">
			<label class="form-label col-xs-4 col-sm-2">运费：</label>
			<div class="formControls col-xs-8 col-sm-9">
				<input type="number" class="input-text" min="0" max="9999" value="{$newsxiugl.yfmoney}" placeholder="" id="" name="yfmoney">
			</div>
		</div>
		<div class="row cl">
			<label class="form-label col-xs-4 col-sm-2"><span class="c-red">*</span>运费描述：</label>
			<div class="formControls col-xs-8 col-sm-9">
				<input type="text" class="input-text" value="{$newsxiugl.yunfei}" placeholder="" id="keywords" name="yunfei">
			</div>
		</div>
		<div class="row cl">
			<label class="form-label col-xs-4 col-sm-2">需要积分：</label>
			<div class="formControls col-xs-8 col-sm-9" style="width: 30%;">
				<input type="number" class="input-text" min="0" max="9999" value="{$newsxiugl.xyjifen}" placeholder="" id="" name="xyjifen">
			</div>
			<label class="form-label col-xs-4 col-sm-2">排序值：</label>
			<div class="formControls col-xs-8 col-sm-9" style="width: 30%;">
				<input type="number" class="input-text" min="0" max="9999" value="0" placeholder="值越大越靠前" id="ordernum" name="sort">
			</div>
		</div>
		<div class="row cl">
			<label class="form-label col-xs-4 col-sm-2">商品库存：</label>
			<div class="formControls col-xs-8 col-sm-9">
				<input type="number" min="0" max="9999" required style="width:90%;margin-top:10px" class="input-text"  placeholder="请输入数字" id="" name="nums" value="{$newsxiugl.nums}">
			</div>
		</div>
		<div class="row cl">
			<label class="form-label col-xs-4 col-sm-2"><span class="c-red">*</span>规格：</label>
			<div class="formControls col-xs-8 col-sm-9">
				<input type="text" class="input-text" value="{$newsxiugl.guige}" placeholder="" id="keywords" name="guige">
			</div>
		</div>
		<div  id="bunew" style="display: block;">
		<div class="row cl">
			<label class="form-label col-xs-4 col-sm-2"><span class="c-red">*</span>商品封面图：</label>
			<div class="tusc_box fl" style="float:left;">
				<div class="tusc_page ">
					<div class="sc_btn1 fl">
						<div class="upload-area">
							<input type="file" name="fileurl"  id="file_uploadgl">
						</div>
					</div>
				</div>
				<div class="sctishi fl" style="font-size: 12px"><span class="c-red">*</span>支持 jpg/png/gif/jpeg ,建议428 X 428px
				</div>
				<div id="filenamegl"></div>
			</div>
		</div>
		<div class="row cl">
				<label class="form-label col-xs-4 col-sm-2"><span class="c-red">*</span>商品封面图缩略图：</label>
				<div class="tusc_box fl" style="float:left;">
					<div class="tusc_page ">
						<img class="pic" src="{$newsxiugl.imgurl}" style="height:128px;width: 128px;">
					</div>
				</div>
			</div>
			<div class="row cl">
				<label class="form-label col-xs-4 col-sm-2"><span class="c-red">*</span>商品细节图：</label>
				<div class="tusc_box fl"  style="float:left;">
					<div class="tusc_page" class='roll_up'>
						<div class="sc_btn1 fl">
							<div class="upload-area">
								<input type="file" name="fileurl" id="file_upload" >
							</div>
						</div>
					</div>
					<div class="sctishi fl" style="font-size: 12px"><span class="c-red">*</span>支持 jpg/png/gif/jpeg ,建议428 X 428px</div>
					<div id="filename">
					</div>
				</div>
			</div>
			<div class="row cl">
				<label class="form-label col-xs-4 col-sm-2"><span class="c-red">*</span>商品细节图缩略图：</label>
				<div class="tusc_box fl"  style="float:left;">
					<volist name="imgroll" id="vo">
							<img class="pic" src="{$vo}" style="height:114px;width: 114px;">
					</volist>
				</div>
			</div>
			<div class="row cl">
				<label class="form-label col-xs-4 col-sm-2">商品详情：</label>
				<div class="formControls col-xs-8 col-sm-9">
					<textarea id="editor" name="text" style="width:100%;height:400px;">{$newsxiugl.text}</textarea>
				</div>
			</div>
		</div>
		<div class="row cl">
			<div class="col-xs-8 col-sm-9 col-xs-offset-4 col-sm-offset-2">
			<input type="hidden" name="id" value="{$newsxiugl.id}">
				<button onClick="article_save_submit();" class="btn btn-primary radius" type="submit"><i class="Hui-iconfont">&#xe632;</i> <if condition="empty($newsxiugl['id'])">提交<else/>修改</if></button>
			</div>
		</div>
	</form>
</article>

<!--_footer 作为公共模版分离出去-->
<include file="Public:footer"/>
<!--/_footer /作为公共模版分离出去-->

<!--请在下方写此页面业务相关的脚本-->
<script type="text/javascript" src="__ROOT__/Public/lib/My97DatePicker/WdatePicker.js"></script>
<script type="text/javascript" src="__ROOT__/Public/lib/webuploader/0.1.5/webuploader.min.js"></script>
<script type="text/javascript" src="__ROOT__/Public/lib/ueditor/1.4.3/ueditor.config.js"></script>
<script type="text/javascript" src="__ROOT__/Public/lib/ueditor/1.4.3/ueditor.all.min.js"> </script>
<script type="text/javascript" src="__ROOT__/Public/lib/ueditor/1.4.3/lang/zh-cn/zh-cn.js"></script>
<script charset="utf-8" src="__ROOT__/Public/web/js/uploadify/jquery.uploadify.min.js"></script>
<script type="text/javascript">
$(function(){


	$("#form-news-add").validate({
		rules:{
			gname:{
				required:true,
				minlength:5,
				maxlength:50
			},
			type:{
				required:true,
			},
			keywords:{
				required:true,
				minlength:5,
				maxlength:50
			},
			description:{
				required:true,
				minlength:10,
				maxlength:200,
			},
			text:{
				required:true,
				minlength:10,
				maxlength:200,
			},
		},
		onkeyup:false,
		focusCleanup:true,
		success:"valid",
		submitHandler:function(form){
			var content = $("input[name='imgurlglgo[]']").val();
			var content2 = $("input[name='imgurlgl[]']").val();
			var val=$("input[type='radio']:checked").val();
			var fir=$('#first').val();
			var sec=$('#second').val();
			var thi=$('#third').val();
			var is_reset=$('#is_reset').val();
			if(fir == ''){
				alert('请选择一级分类');
				return false;
			}
			if(sec == ''){
				alert('请选择二级分类');
				return false;
			}
			if(thi == ''){
				alert('请选择三级分类');
				return false;
			}
			if(val == 1){
				if(is_reset == -1){
					var dt=1;
				}else{
					var dt=$('.open').attr('data-type');
				}
				if(dt != 1){
					alert('请正确设置规格参数再提交');
					return false;
				}
			}else{
				var num=$("input[name='num']").val();
				var price=$("input[name='price']").val();
				if(price == ''){
					alert('请填写商品价格');
					return false;
				}
				if(num == ''){
					alert('请填写商品库存');
					return false;
				}
			}
			/*if(content==undefined){
				alert('请上传商品封面图片');
				return false;
			}
			if(content2==undefined){
				alert('请上传商品轮播图');
				return false;
			}*/
			$(form).ajaxSubmit();
			var index = parent.layer.getFrameIndex(window.name);
			parent.$('.btn-refresh').click();
			parent.layer.close(index);
		}
	});

	$('.skin-minimal input').iCheck({
		checkboxClass: 'icheckbox-blue',
		radioClass: 'iradio-blue',
		increaseArea: '20%'
	});
	var ue = UE.getEditor('editor');
});
var rlength=$('.roll').length;
var flength=$('.face').length;
var img_id_upload=new Array();//初始化数组，存储已经上传的图片名
var i=0;//初始化数组下标
var uploadLimit=5;
var uploadLimit2=1;
$(function() {
	$('#file_upload').uploadify({
//	$('.glup').uploadify({
		'auto'     : true,//关闭自动上传
		'removeTimeout' : 0.5,//文件队列上传完成0.5秒后删除
		'swf'      : '__ROOT__/Public/web/js/uploadify/uploadify.swf',
		'fileObjName':'fileurl',
		'uploader' : '{:U("Pic/uploadify")}',
		'method'   : 'post',          //方法，服务端可以用$_POST数组获取数据
		'buttonText' : '选择图片',//设置按钮文本
		'multi'    : true,//允许同时上传多个
		'fileTypeDesc' : 'Image Files',//只允许上传图像
		'fileTypeExts' : '*.gif; *.jpg; *.png; *.jpeg',//限制允许上传的图片后缀
		'uploadLimit' : uploadLimit,//一次最多只允许上传
		'fileSizeLimit' : '3MB',//限制上传大小
		'width' 		: '70',  //@fanboo
		'height' 		: '30',  //@fanboo
		//返回一个错误，选择文件的时候触发
		'onSelectError': function (file, errorCode, errorMsg) {
			switch (errorCode) {
				case -100:
					alert("上传的文件数量已经超出系统限制的4个文件！");
//					alert("上传的文件数量已经超出系统限制的" + $('#file_upload').uploadify('settings', 'uploadLimit') + "个文件！");
					return false;
				case -110:
					alert("文件 [" + file.name + "] 大小超出系统限制的" + $('#file_upload').uploadify('settings', 'fileSizeLimit') + "大小！");
//					alert("文件 [" + file.name + "] 大小超出系统限制的" + $('#file_upload').uploadify('settings', 'fileSizeLimit') + "大小！");
					return false;
			}
		},
		'onUploadSuccess' : function(file, data, response) { //每次成功上传后执行的回调函数，从服务端返回数据到前端
			var str = "<div style='float:left;padding-top:10px'><input name='imgurlgl[]' type='hidden'  value='"+data+"'><img class='pic' src='"+data+"'  style='margin-left:10px' width='100' height='100'><img class='delete' style='margin-top: -80px;' onclick='djxs(this)' title='点击删除' src='/Public/admin/images/tubiao_delete.png' width='14' height='14'></div>";
			$("#filename").append(str);
		}
	});
	 img_id_upload=new Array();//初始化数组，存储已经上传的图片名
//	var i=0;//初始化数组下标
	$('#file_uploadgl').uploadify({
		'auto'     : true,//关闭自动上传
		'removeTimeout' : 0.5,//文件队列上传完成0.5秒后删除
		'swf'      : '__ROOT__/Public/web/js/uploadify/uploadify.swf',
		'fileObjName':'fileurl',
		'uploader' : '{:U("Pic/uploadify")}',
		'method'   : 'post',          //方法，服务端可以用$_POST数组获取数据
		'buttonText' : '选择图片',//设置按钮文本
		'multi'    : true,//允许同时上传多个
		'fileTypeDesc' : 'Image Files',//只允许上传图像
		'fileTypeExts' : '*.gif; *.jpg; *.png; *.jpeg',//限制允许上传的图片后缀
		'uploadLimit' : uploadLimit2,//一次最多只允许上传
		'fileSizeLimit' : '3MB',//限制上传大小
		'width' 		: '70',  //@fanboo
		'height' 		: '30',  //@fanboo
		//返回一个错误，选择文件的时候触发
		'onSelectError': function (file, errorCode, errorMsg) {
			switch (errorCode) {
				case -100:
					alert("上传的文件数量已经超出系统限制的1个文件！");
//					alert("上传的文件数量已经超出系统限制的" + $('#file_upload').uploadify('settings', 'uploadLimit') + "个文件！");
					return false;
				case -110:
					alert("文件 [" + file.name + "] 大小超出系统限制的" + $('#file_uploadgl').uploadify('settings', 'fileSizeLimit') + "大小！");
//					alert("文件 [" + file.name + "] 大小超出系统限制的" + $('#file_upload').uploadify('settings', 'fileSizeLimit') + "大小！");
					return false;
			}
		},
		'onUploadSuccess' : function(file, data, response) { //每次成功上传后执行的回调函数，从服务端返回数据到前端
			var str = "<div style='float:left;padding-top:10px'><input name='imgurlglgo[]' type='hidden' value='"+data+"'><img class='pic' src='"+data+"'  style='margin-left:10px' width='100' height='100'><img class='delete' onclick='djxs2(this)' title='点击删除' style='margin-top: -80px;'  src='/Public/admin/images/tubiao_delete.png' width='14' height='14'></div>";
			$("#filenamegl").append(str);
		}
	});
});


function djxs(o){
		uploadLimit=uploadLimit+1;
		var num=$('#file_upload').uploadify('settings','uploadLimit', uploadLimit);
		$(o).parent().remove();
}
function djxs2(o){
	uploadLimit2=uploadLimit2+1;
	var num=$('#file_uploadgl').uploadify('settings','uploadLimit', uploadLimit2);
	$(o).parent().remove();
}


function glnew(){
	$("#bunew").toggle();
	$("#wonew").toggle();
}
function nonew(){
	$("#bunew").toggle();
	$("#wonew").toggle();
}

</script>
<!--/请在上方写此页面业务相关的脚本-->
</body>
</html>